<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue 项目中 Updated 生命周期及 nextTick 方法的应用实例 | Meteor</title>
    <meta name="description" content="欢迎来到我的个人页面">
    
    
    <link rel="preload" href="/MyBlog/assets/css/23.styles.cc84573a.css" as="style"><link rel="preload" href="/MyBlog/assets/js/app.19eb8d83.js" as="script"><link rel="preload" href="/MyBlog/assets/js/18.9a90913a.js" as="script"><link rel="prefetch" href="/MyBlog/assets/js/12.53cafe37.js"><link rel="prefetch" href="/MyBlog/assets/js/1.38c1cab2.js"><link rel="prefetch" href="/MyBlog/assets/js/2.493d4717.js"><link rel="prefetch" href="/MyBlog/assets/js/3.fec61410.js"><link rel="prefetch" href="/MyBlog/assets/js/4.7b46e1a9.js"><link rel="prefetch" href="/MyBlog/assets/js/5.a8da7034.js"><link rel="prefetch" href="/MyBlog/assets/js/6.1afa3de3.js"><link rel="prefetch" href="/MyBlog/assets/js/7.bb628056.js"><link rel="prefetch" href="/MyBlog/assets/js/8.4320c542.js"><link rel="prefetch" href="/MyBlog/assets/js/9.ae9485eb.js"><link rel="prefetch" href="/MyBlog/assets/js/10.4f6f2f80.js"><link rel="prefetch" href="/MyBlog/assets/js/11.3dd0d6bb.js"><link rel="prefetch" href="/MyBlog/assets/js/13.4a7a2bd8.js"><link rel="prefetch" href="/MyBlog/assets/js/14.fd64b4ff.js"><link rel="prefetch" href="/MyBlog/assets/js/15.0aea93d5.js"><link rel="prefetch" href="/MyBlog/assets/js/16.205e0222.js"><link rel="prefetch" href="/MyBlog/assets/js/17.23dda7fa.js"><link rel="prefetch" href="/MyBlog/assets/js/19.217ac63a.js"><link rel="prefetch" href="/MyBlog/assets/js/20.e5f657ab.js"><link rel="prefetch" href="/MyBlog/assets/js/21.a7e51597.js"><link rel="prefetch" href="/MyBlog/assets/js/22.4c47086b.js">
    <link rel="stylesheet" href="/MyBlog/assets/css/23.styles.cc84573a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/MyBlog/" class="home-link router-link-active"><!----><span class="site-name">
      Meteor
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/MyBlog/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博客</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://github.com/MeteorOCC" target="_blank" rel="noopener noreferrer" class="nav-link external">
  正在动工,可先使用搜索栏搜索关键字寻找博文
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://github.com/MeteorOCC" target="_blank" rel="noopener noreferrer" class="nav-link external">
  并没有这一个选项quq
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/MyBlog/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博客</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://github.com/MeteorOCC" target="_blank" rel="noopener noreferrer" class="nav-link external">
  正在动工,可先使用搜索栏搜索关键字寻找博文
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://github.com/MeteorOCC" target="_blank" rel="noopener noreferrer" class="nav-link external">
  并没有这一个选项quq
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><!----></nav><!----></div><div class="page"><div class="content"><h2 id="vue-项目中-updated-生命周期及-nexttick-方法的应用实例"><a href="#vue-项目中-updated-生命周期及-nexttick-方法的应用实例" aria-hidden="true" class="header-anchor">#</a> Vue 项目中 Updated 生命周期及 nextTick 方法的应用实例</h2><h3 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h3><p>可能很多同学在撸 Vue 业务的时候基本没有用到 Updated 生命周期和 nextTick 方法吧，毕竟绝大部分业务下来，常用的生命周期<code>mounted</code>、<code>created</code>、<code>beforeCreated</code>已经足够使用了。</p><p>但是，本篇博文中想着重介绍一下 Updated 生命周期和 nextTick 方法，因为这两个方法解决了我一个头疼的问题。</p><p>在许多项目中应该都有一个消息页面，这个消息页面通过 Ajax 请求获取后端的数据列表，当字数超过 N(我项中<code>N=2</code>)行的时候提供展开/收缩功能，收缩的时候只显示 N 行的字，多余的字用''...''代替，展开的时候该列表自适应高度展示所有的文字。</p><p>实际上如果仅仅是<code>收缩的时候只显示N行的字，多余的字用''...''代替，展开的时候该列表自适应高度展示所有的文字。</code>这个功能反倒是好解决的，参考：<a href="http://www.css88.com/webkit/-webkit-line-clamp/" target="_blank" rel="noopener noreferrer">多行文本的情况下，用省略号“...”隐藏超出范围的文本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>但是，<code>当字数超过N行时提供展开/收缩功能</code>这个问题就不太好解决了，因为我们已经使用了 CSS 来解决问题，对于它是否超过 N 行这种行为，我们是不知道的。而在 Dom 元素中，我们可以看到在没有超过 N 行的时候，虽然展示有显示&quot;...&quot;，但是实际获取其值的时候还是所有的文字值，没有&quot;…&quot;供我们判断。</p><p>在前端历史长河中，一般都是使用：</p><blockquote><p>文字父元素宽度/font-size=可容纳字符数；</p><p>通过这种方式可轻量实现(不考虑不同字符宽度不同)</p></blockquote><p>这种方法来解决，而考虑更周到一些，那就还要判断行高和平均字宽，等等。</p><p>如果想做的较为完美，那就要引入几个第三方解决库，而我是不太乐意的。</p><blockquote><p>注意：<code>-webkit-box-orient</code>在被 webpack 编译的时候会被忽略掉，原因是<code>optimize-css-assets-webpack-plugin</code>这个插件的问题，它认为<code>-webkit-box-orient</code>是一个不标准的属性，不应该被应用到项目中，但是实际上较新的 webkit 浏览器都是支持的，这里可以使用下方代码块的代码来解决这个问题。</p><div class="language-scss extra-class"><pre class="language-scss"><code><span class="token comment">/*! autoprefixer: off */</span>
<span class="token property">-webkit-box-orient</span><span class="token punctuation">:</span> vertical<span class="token punctuation">;</span>
<span class="token comment">/* autoprefixer: on */</span>
</code></pre></div></blockquote><h3 id="想法"><a href="#想法" aria-hidden="true" class="header-anchor">#</a> 想法</h3><p>默认给所有的列表项都加上<code>展开/收缩功能</code>，先展开列表项记录它们展开时高度，再收缩列表项记录它们收缩时高度，对比两者高度，相同的则是不需要<code>展开/收缩功能</code>的项，而不同的则是需要<code>展开/收缩功能</code>的项。</p><p>理想很丰满现实很骨感，通过些许实践我碰到了阻碍，因为这些数据项都是通过 V-for 循环创建的，而<code>在什么时候获取Dom元素的高度值这个时机</code>便是一个问题，另一个问题则是如果通过代码级别的来控制其<code>展开/收缩</code>，比如说：</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>cellList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  item<span class="token punctuation">.</span>extend <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token comment">//这个时候做一些什么事情</span>
  item<span class="token punctuation">.</span>extend <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token comment">//这个时候再做一些什么事情</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这种代码，并不会触发任何 Dom 上的更新，因为 Vue 有个<code>虚拟Dom</code>的机制，它先会在<code>虚拟Dom</code>上实现我们的行为，然后再判断要不要更新实际的 Dom。如果直接在 mounted 中去获取 Dom，则可能什么都拿不到(mounted 时 Dom 未必 已经渲染完毕)。</p><p>详阅:<a href="https://cn.vuejs.org/v2/guide/reactivity.html#%E5%BC%82%E6%AD%A5%E6%9B%B4%E6%96%B0%E9%98%9F%E5%88%97" target="_blank" rel="noopener noreferrer">异步更新队列<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h3 id="updated"><a href="#updated" aria-hidden="true" class="header-anchor">#</a> Updated</h3><ul><li><p>类型:<code>Function</code></p></li><li><p>详细:</p><p>由于数据更改导致的虚拟 DOM 重新渲染和打补丁，在这之后会调用该钩子。</p><p>当这个钩子被调用时，组件 DOM 已经更新，所以你现在可以执行依赖于 DOM 的操作。然而在大多数情况下，你应该避免在此期间更改状态。如果要相应状态改变，通常最好使用<a href="https://cn.vuejs.org/v2/api/#computed" target="_blank" rel="noopener noreferrer">计算属性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>或 <a href="https://cn.vuejs.org/v2/api/#watch" target="_blank" rel="noopener noreferrer">watcher<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 取而代之。</p><p>注意 <code>updated</code><strong>不会</strong>承诺所有的子组件也都一起被重绘。如果你希望等到整个视图都重绘完毕，可以用 <a href="https://cn.vuejs.org/v2/api/#vm-nextTick" target="_blank" rel="noopener noreferrer">vm.$nextTick<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 替换掉 <code>updated</code>：</p></li></ul><div class="language- extra-class"><pre class="language-text"><code>updated: function () {
  this.$nextTick(function () {
    // Code that will run only after the
    // entire view has been re-rendered
  })
}
</code></pre></div><p><strong>该钩子在服务器端渲染期间不被调用。</strong></p><p>详阅：<a href="https://cn.vuejs.org/v2/api/#updated" target="_blank" rel="noopener noreferrer">Updated 钩子<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><blockquote><p>博主通过实践之后简述一下这个钩子的注意事项及作用</p><p>注意事项：data 发生变化且改变 Dom 时则会调用一次 Updated，所以请不要在 Updated 中给会影响 Dom 的 data 赋值，这样会造成无限循环。</p><p>作用：每次因 data 更新导致的 Dom 更新则会触发该钩子，我们可以通过这个来记录一些 Dom 刷新时自己需要记录的数据。</p></blockquote><h3 id="vm-nexttick-callback"><a href="#vm-nexttick-callback" aria-hidden="true" class="header-anchor">#</a> Vm.$nextTick([callback])</h3><ul><li><p><strong>参数</strong>：</p><ul><li><code>{Function} [callback]</code></li></ul></li><li><p><strong>用法</strong>：</p><p>将回调延迟到下次 DOM 更新循环之后执行。在修改数据之后立即使用它，然后等待 DOM 更新。它跟全局方法 <code>Vue.nextTick</code> 一样，不同的是回调的 <code>this</code> 自动绑定到调用它的实例上。</p><blockquote><p>2.1.0 起新增：如果没有提供回调且在支持 Promise 的环境中，则返回一个 Promise。请注意 Vue 不自带 Promise 的 polyfill，所以如果你的目标浏览器不是原生支持 Promise (IE：你们都看我干嘛)，你得自行 polyfill。</p></blockquote></li><li><p><strong>示例</strong>：</p><div class="language- extra-class"><pre class="language-text"><code>new Vue({
  // ...
  methods: {
    // ...
    example: function () {
      // 修改数据
      this.message = 'changed'
      // DOM 还没有更新
      this.$nextTick(function () {
        // DOM 现在更新了
        // `this` 绑定到当前实例
        this.doSomethingElse()
      })
    }
  }
})
</code></pre></div></li><li><p><strong>参考</strong>：<a href="https://cn.vuejs.org/v2/api/#Vue-nextTick" target="_blank" rel="noopener noreferrer">Vue.nextTick<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul><blockquote><p>博主通过实践之后简述一下这个方法的作用：</p><p>通过代码去触发 Dom 的更新，也就是说你对<code>Dom</code>更新这个行为有了把控，通过其回调可以马上在更新之后做一些什么事情。</p></blockquote><h3 id="实践"><a href="#实践" aria-hidden="true" class="header-anchor">#</a> 实践</h3><p>看完 Updated 和 Vue.nextTick 的作用之后，想必聪明的同学已经知道<code>在什么时候获取Dom元素的高度值这个时机</code>及&quot;绕过&quot;<code>虚拟Dom</code></p><p>截取一些业务上面的代码来说明这次实践：</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//我们将获取的消息数据列表项全部设置为展开，然后触发一次Dom更新后将数据列表项全部设置为收缩。</span>
<span class="token comment">//this.cellList为数据列表，extend属性定义是否展开，extendDisplay属性定义是否提供`展开/收缩功能`</span>
<span class="token comment">//this.extendList记录展开时的高度,this.shrinkList记录收缩时的高度</span>
<span class="token comment">//this.extendDisplay记录需要关闭`展开/收缩功能`的index值</span>
<span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token constant">API</span><span class="token punctuation">.</span><span class="token constant">MESSAGE</span><span class="token punctuation">.</span><span class="token constant">LIST</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> params<span class="token punctuation">:</span> <span class="token punctuation">{</span> pageNo<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>page <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=&gt;</span> 	  <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                item<span class="token punctuation">.</span>extend <span class="token operator">=</span> <span class="token boolean">true</span>
                item<span class="token punctuation">.</span>extendDisplay <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>page<span class="token operator">++</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cellList <span class="token operator">=</span> data
        <span class="token comment">//刷新Dom</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 刷新DOM时执行</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>cellList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                item<span class="token punctuation">.</span>extend <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">//因data改变导致的Dom变化会触发updated钩子</span>
<span class="token function">updated</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>extendList<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cellList<span class="token punctuation">.</span>length <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shrinkList<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cellList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>cellContent<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cellList<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>extend <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>extendList<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cellList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>extendList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span>
                <span class="token comment">// console.log('展开时', this.extendList)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>cellList<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>extend <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shrinkList<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cellList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>shrinkList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span>
                <span class="token comment">// console.log('收缩时', this.shrinkList)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>extendDisplay <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>extendList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shrinkList<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>extendDisplay<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 通过监听extendDisplay这个数组的变化，我们获取记录完成后的extendDisplay中index索引，通过这个来判断cellList的index项是否提供`展开/收缩功能`</span>
watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    extendDisplay<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        deep<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token function">handler</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>shrinkList<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cellList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>extendDisplay<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>cellList<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">.</span>extendDisplay <span class="token operator">=</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="总结："><a href="#总结：" aria-hidden="true" class="header-anchor">#</a> 总结：</h2><p>熟悉生命周期及一些 API 对我们开发大有裨益，推荐各位看一个框架之前先对官方文档通读一次。</p><blockquote><p>另外官方并不推荐使用 nextTick 方法，因为这一定程度上会使流程复杂化，本来只是生命周期一条流水线这样下来，过多使用 nextTick 会存在很多不确定性。</p></blockquote></div><div class="page-edit"><!----><!----></div><!----></div></div></div>
    <script src="/MyBlog/assets/js/18.9a90913a.js" defer></script><script src="/MyBlog/assets/js/app.19eb8d83.js" defer></script>
  </body>
</html>
