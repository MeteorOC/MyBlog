<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目结构架构概述： | Meteor</title>
    <meta name="description" content="欢迎来到我的个人页面">
    
    
    <link rel="preload" href="/MyBlog/assets/css/23.styles.cc84573a.css" as="style"><link rel="preload" href="/MyBlog/assets/js/app.19eb8d83.js" as="script"><link rel="preload" href="/MyBlog/assets/js/13.4a7a2bd8.js" as="script"><link rel="prefetch" href="/MyBlog/assets/js/12.53cafe37.js"><link rel="prefetch" href="/MyBlog/assets/js/1.38c1cab2.js"><link rel="prefetch" href="/MyBlog/assets/js/2.493d4717.js"><link rel="prefetch" href="/MyBlog/assets/js/3.fec61410.js"><link rel="prefetch" href="/MyBlog/assets/js/4.7b46e1a9.js"><link rel="prefetch" href="/MyBlog/assets/js/5.a8da7034.js"><link rel="prefetch" href="/MyBlog/assets/js/6.1afa3de3.js"><link rel="prefetch" href="/MyBlog/assets/js/7.bb628056.js"><link rel="prefetch" href="/MyBlog/assets/js/8.4320c542.js"><link rel="prefetch" href="/MyBlog/assets/js/9.ae9485eb.js"><link rel="prefetch" href="/MyBlog/assets/js/10.4f6f2f80.js"><link rel="prefetch" href="/MyBlog/assets/js/11.3dd0d6bb.js"><link rel="prefetch" href="/MyBlog/assets/js/14.fd64b4ff.js"><link rel="prefetch" href="/MyBlog/assets/js/15.0aea93d5.js"><link rel="prefetch" href="/MyBlog/assets/js/16.205e0222.js"><link rel="prefetch" href="/MyBlog/assets/js/17.23dda7fa.js"><link rel="prefetch" href="/MyBlog/assets/js/18.9a90913a.js"><link rel="prefetch" href="/MyBlog/assets/js/19.217ac63a.js"><link rel="prefetch" href="/MyBlog/assets/js/20.e5f657ab.js"><link rel="prefetch" href="/MyBlog/assets/js/21.a7e51597.js"><link rel="prefetch" href="/MyBlog/assets/js/22.4c47086b.js">
    <link rel="stylesheet" href="/MyBlog/assets/css/23.styles.cc84573a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/MyBlog/" class="home-link router-link-active"><!----><span class="site-name">
      Meteor
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/MyBlog/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博客</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://github.com/MeteorOCC" target="_blank" rel="noopener noreferrer" class="nav-link external">
  正在动工,可先使用搜索栏搜索关键字寻找博文
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://github.com/MeteorOCC" target="_blank" rel="noopener noreferrer" class="nav-link external">
  并没有这一个选项quq
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/MyBlog/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博客</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://github.com/MeteorOCC" target="_blank" rel="noopener noreferrer" class="nav-link external">
  正在动工,可先使用搜索栏搜索关键字寻找博文
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://github.com/MeteorOCC" target="_blank" rel="noopener noreferrer" class="nav-link external">
  并没有这一个选项quq
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><!----></nav><!----></div><div class="page"><div class="content"><h2 id="项目结构架构概述："><a href="#项目结构架构概述：" aria-hidden="true" class="header-anchor">#</a> 项目结构架构概述：</h2><h3 id="项目架构：三级依赖"><a href="#项目架构：三级依赖" aria-hidden="true" class="header-anchor">#</a> 项目架构：三级依赖</h3><p><img src="/MyBlog/%E4%B8%89%E7%BA%A7%E4%BE%9D%E8%B5%96%E6%9E%B6%E6%9E%84%E5%9B%BE.png" alt="img"></p><blockquote><p>如图所示，项目分为八大公共库。内含项目运作所需的公共方法/资源/样式/对第三方依赖的处理/Webpack 配置。</p><p>公共页面库里面存储了整个 APP 内都需要用到的<code>通用</code>页面，本质上跟模块是一样的，只不过称呼不一样。而每个模块都像是一个微型总库，只不过产物和总库不一样。</p><p>总库经过 Webpack 构建库产出的是一个完整的，含 html、js、css 的前端项目。而各公共库、模块库产出的仅为经过 Webpack 构件库处理后压缩混淆的 js、css 代码，或直接被总库所用，或被路由库引用后再被总库所用。</p></blockquote><h4 id="工作原理："><a href="#工作原理：" aria-hidden="true" class="header-anchor">#</a> 工作原理：</h4><p><strong>代码仓库</strong>：Gogs</p><p><strong>私有 Npm 库</strong>：Verdaccio</p><p><strong>自动构建</strong>：Drone</p><p><strong>流程</strong>：每个开发者都会有自己的一个<code>所有平台共享</code>的账号，开发者仅需将代码推向 Gogs 中，由 DevOps 工程师部署的脚本对推上的内容进行简单校验并对版本号进行修改(该步骤是经过各方沟通后决定)确认无误后，由 CI 账户（开发者无权限）推送至 Verdaccio，在公司的私有 Drone 页面可以看到推送过程。</p><p>这样开发者就可以用 npm 工具来管理自己所发布的 package（这个 package 的意思就是将开发者的代码进行压缩混淆后的产物，在 Verdaccio 上存储。如果 A 开发者没有 B 开发者 Gogs 仓库的权限，那么这是 A 开发者看到 B 开发者代码的唯一方式。）</p><h4 id="架构优点："><a href="#架构优点：" aria-hidden="true" class="header-anchor">#</a> 架构优点：</h4><p>权限控制优秀，源码保密性强。</p><p>在严格的权限管理下，开发者仅需简单的推送代码即可完成功能的迭代，每个开发者负责的模块交集少，从模块的角度上来说，代码污染情况很少发生。</p><h4 id="架构缺点："><a href="#架构缺点：" aria-hidden="true" class="header-anchor">#</a> 架构缺点：</h4><p>① 公共库之间代码污染明显，如果不是公共库管理者，对于其中的行为及变量传递必然不是很清楚。</p><p>比如说对于工具库而言，内含各种公共方法/第三方依赖修改，不可避免的会操作到全局变量库的内容。此时就会需要在工具库各文件内都引入 store 变量。</p><p>② 调试困难。</p><p>一般的项目架构是走分支合并的路线，在一个文件夹内开发。各种变量及依赖关系一目了然，搜索方便。功能验证仅需开启 DevServer 即可看到结果，无需做二次三次 Check。</p><p>而在三级依赖架构中，我们每次推送代码，首先自己的模块内会启动 DevServer 进行校验一次，然后推送至 Verdaccio 后需要在总库 Upgrade package 后再校验一次。其中会浪费一定的时间。</p><p>而且如果我们看到，A/B/C 三个库可能都依赖一个公共方法，我们对这个公共方法进行了修改，那么可能需要先推送公共方法至 Gogs 库走流程，等构建完毕再轮流到 A/B/C 三个库去验证我们代码的可靠性。</p><p>目前项目还是没有一个供开发者使用的 Dev 环境，开发者做了什么改动/尝试，都会一步到位的到预生产环境，这就会让测试非常迷惑：为什么之前出现的一个问题现在又频繁复现，到底是开发者最终的代码问题还是他们在修改功能中引发的问题？</p><p>③Webpack 配置繁琐，依赖引入麻烦。</p><p>就说 Vue-router 官方允许我们使用懒加载的方式异步加载路由，这样可以让单页应用不再臃肿。</p><p>但是如果按照项目的三级依赖来说，我们首先在应用异步加载上面就出现了困难，因为我们不是直接在目录中引入一个.vue 文件那么简单，我们面对的是一个经过 Webpack 处理的 index.js 大文件。</p><p>对于初步接触框架的开发者来说这无疑是个很让人困惑的事情-&gt;为什么我按照官方给的例子自行尝试的时候发现没有效果/报错？到底是我的问题还是 Vue 官方的问题还是项目框架的问题？</p><p>经过后面和云翔一起探讨，我们发现其实 Vue-router 在对于懒加载的处理上，其接受的是一个 Function，内返回一个 Promise 对象。对于经过 Webpack 处理后的模块，其本身就是一个 Promise，直接按照官方给的例子自然是无法正常运作。我们在其外面包裹了一层 Function 后异步加载才算是正常运作。</p><p>但是方案并不完美，因为我们仅能按<code>模块</code>来异步加载，这已经是三级依赖在目前 Webpack 极致下的极限，除非我们可以去改动 Webpack 的源码或者自己创建一个 loader 之类的东西专门处理这种情况。</p><p>④ 封闭</p><p>源码不暴露，开发者之间交流困难，这样容易造成代码体积变大，同样功能的实现方式不同。</p><p>同样代码的事先方式不同，如果需求变更，那么三个开发者可能都需要去修改自己的代码。实际上这种代码仅需一个人维护一份即可，这也是同事之间 Review 代码的重要性。</p><p>⑤ 低效</p><p>Npm 依赖的本意是提供一个可靠/稳定的版本，本身功能并非迭代代码。</p><p>而 Git 被发明的初衷是代码版本管理，更倾向于迭代。</p><p>通过 Npm 依赖，我们每次更新代码都需要漫长的遍历所有的模块（包括第三方稳定依赖），也就是说从寻径来说已经慢了一大截。</p><h3 id="项目架构改进想法：gitsubmodule"><a href="#项目架构改进想法：gitsubmodule" aria-hidden="true" class="header-anchor">#</a> 项目架构改进想法：gitSubmodule</h3><p><img src="/MyBlog/gitsubmodule%E6%9E%B6%E6%9E%84%E5%9B%BE.jpg" alt="image-20181010125153863"></p><p>gitSubmodule 主要的作用就是一种权限管理：比如说一个父模块里面包含了很多子模块</p><p>1.对于这些子模块，父模块本身可以本地修改子模块查看效果，但是无法提交对子模块进行提交。</p><p>2.这些子模块需要有其权限的开发者才能够提交。</p><p>3.父模块可以更新子模块拉取最新的代码。</p><h4 id="工作原理：-2"><a href="#工作原理：-2" aria-hidden="true" class="header-anchor">#</a> 工作原理：</h4><p><strong>代码仓库</strong>：Gogs</p><p><strong>自动构建</strong>：Drone</p><p><strong>流程</strong>：每个开发者都会拥有一个类似于<code>三级依赖架构</code>总库代码仓库的只读权限，这就是项目开发的主目录。主目录下面包含 N 个子模块，开发者需要查看的时候可在总库&quot;修改&quot;子模块的内容方便调试但无法影响到子模块。更新子模块代码也无需 Npm 参与。CI 账号定期在总库拉取最新的子模块代码并 build 一下即可放入我们的服务器。</p><h4 id="架构优点：-2"><a href="#架构优点：-2" aria-hidden="true" class="header-anchor">#</a> 架构优点：</h4><p>① 调试简单，哪里出现问题直接修改代码即可看到结果。</p><p>② 层级明显，清晰。</p><p>③ 高效。无需 Npm 参与，直接 Git 拉取代码即可看到最新功能。</p><p>④ 污染小。无论是公共库/模块/总库，均可独立开发互不影响，又可清晰的看到其它开发者加入了什么内容。</p><p>⑤ 简单，基本的 Vue CLI 内的 Webpack 配置即可满足项目的所有需求。严格遵循官方的开发规范，所有文档均可简单应用。</p><h4 id="架构缺点：-2"><a href="#架构缺点：-2" aria-hidden="true" class="header-anchor">#</a> 架构缺点：</h4><p>相对于三级依赖架构，对源码无任何保护性。</p></div><div class="page-edit"><!----><!----></div><!----></div></div></div>
    <script src="/MyBlog/assets/js/13.4a7a2bd8.js" defer></script><script src="/MyBlog/assets/js/app.19eb8d83.js" defer></script>
  </body>
</html>
